<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>شجرة العائلة</title>

  <!-- Police arabe depuis Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Noto+Naskh+Arabic&display=swap" rel="stylesheet">

  <!-- Favicon (facultatif) -->
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <style>
    body {
      font-family: 'Noto Naskh Arabic', 'Amiri', serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      direction: rtl;
    }

    h1 {
      text-align: center;
      color: #333;
      margin: 1em 0;
    }

    svg {
      display: block;
      margin: auto;
    }

    text {
      font-family: 'Amiri', 'Noto Naskh Arabic', serif;
      font-size: 16px;
      fill: #333;
    }

    .node rect {
      fill: #e0f7fa;
      stroke: #00796b;
      stroke-width: 1.5;
      rx: 10;
      ry: 10;
    }

    .link {
      fill: none;
      stroke: #999;
      stroke-width: 2px;
    }
  </style>
</head>
<body>

  <h1>شجرة العائلة</h1>

  <svg width="1000" height="800"></svg>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    fetch("/api/membres")
      .then(response => response.json())
      .then(data => {
        // Exemple de transformation vers hiérarchie D3 (ajuste selon tes données réelles)
        const root = d3.stratify()
          .id(d => d.id)
          .parentId(d => d.parent_id)(data);

        const tree = d3.tree().size([800, 600]);
        const hierarchy = tree(d3.hierarchy(root));

        const svg = d3.select("svg");
        const g = svg.append("g").attr("transform", "translate(100,50)");

        const link = g.selectAll(".link")
          .data(hierarchy.links())
          .enter().append("path")
          .attr("class", "link")
          .attr("d", d3.linkVertical()
            .x(d => d.x)
            .y(d => d.y));

        const node = g.selectAll(".node")
          .data(hierarchy.descendants())
          .enter().append("g")
          .attr("class", "node")
          .attr("transform", d => `translate(${d.x},${d.y})`);

        node.append("rect")
          .attr("x", -60)
          .attr("y", -20)
          .attr("width", 120)
          .attr("height", 40)
          .attr("rx", 10)
          .attr("ry", 10);

        node.append("text")
          .attr("dy", "0.35em")
          .attr("text-anchor", "middle")
          .text(d => d.data.data.nom);
      });
  </script>
</body>
</html>
